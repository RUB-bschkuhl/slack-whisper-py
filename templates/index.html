<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live-Transkription und interaktives Coaching</title>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            color: #294466;
            background-color: #f4f4f4;
            padding: 2rem;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: #294466;
        }
        h2 {
            margin-bottom: 1rem;
            color: #294466;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            overflow: hidden;
        }

        textarea {
            width: 100%;
            padding: 0.5rem;
            font-size: 1rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            resize: vertical;
            height: 150px;
            margin-bottom: 1rem;
        }

        .butts {
            background-color: #294466;
            color: #fff;
            border: none;
            padding: 2rem;
            border-radius: 1rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            text-align: center;
            white-space: nowrap;
            vertical-align: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            border: 1px solid transparent;
            padding: 0.375rem 0.75rem;
            font-size: 1rem;
            line-height: 1.5;
            border-radius: 0.25rem;
            transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }

        .butts:hover {
            background-color: #273355;
        }

        .spinner-border {
            display: none;
            margin-left: 1rem;
        }

        .row {
            display: flex;
            justify-content: center;
        }

        .coach-card {
            margin: 1rem;
            padding: 1rem;
            background-color: #fff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border-radius: 4px;
        }

        .mt-5 {
            margin-top: 5rem;
        }

        .text-center {
            text-align: center;
        }

        .mb-5 {
            margin-bottom: 5rem;
        }

        .mt-3 {
            margin-top: 3rem;
        }

        .text-light {
            color: #fff;
        }

        #transcriptContent, #suggestionsContent {
            border: 1px solid #ccc;
            padding: 1rem;
            border-radius: 4px;
            background-color: #f8f8f8;
            margin-bottom: 1rem;
        }

        #suggestion {
            font-weight: bold;
        }
    </style>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
    <div class="container">
        <h1 class="text-center mb-3">Live-Transkription - Interaktives Coaching</h1>
        <div class="coach-card">
            <div>
                <div class="row justify-content-center">
                    <div class="col-md-12">
                        <details open>
                                <summary><label for="prompt" class="form-label">Prompt:</label></summary>
                                <textarea id="prompt" rows="10" cols="50">
# IDENTITY and PURPOSE

You are an expert content summarizer. You take content in and output a Markdown formatted summary using the format below.

Take a deep breath and think step by step about how to best accomplish this goal using the following steps.

# OUTPUT SECTIONS

- Combine all of your understanding of the content into a single, 20-word sentence in a section called ONE SENTENCE SUMMARY:.

- Output the 10 most important points of the content as a list with no more than 15 words per point into a section called MAIN POINTS:.

- Output a list of the 5 best takeaways from the content in a section called TAKEAWAYS:.

# OUTPUT INSTRUCTIONS

- Create the output using the formatting above.
- You only output human readable Markdown.
- Output numbered lists, not bullets.
- Do not output warnings or notes—just the requested sections.
- Do not repeat items in the output sections.
- Do not start items with the same opening words.

# INPUT:

INPUT:
                                </textarea>
                        </details>

                        <div class="row justify-content-center">
                            <div class="col-md-12 text-center">
                                <button id="recordButton" class="butts m-2">Start Recording</button>
                                <button id="suggestionButton" class="butts m-2">Get Suggestions GPT 3.5</button>
                                <button id="suggestionButtonGPT4" class="butts m-2">Get Suggestion GPT4</button>
                                <button id="sucheButton" class="butts m-2">DuckDuck Search</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container mt-3">
        <div class="row">
            <div class="col-md-6">
                <div class="coach-card">
                    <div >
                        <h2>Transkript</h2>
                        <div id="transcriptContent" style="min-height: 10em;"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="coach-card">
                    <div>
                        <h2>Vorschläge</h2>
                        <div id="suggestionsContent" style="min-height: em;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const recordButton = document.getElementById('recordButton');
        const transcriptDiv = document.getElementById('transcriptContent');
        const suggestionsDiv = document.getElementById('suggestionsContent');
        const suggestionButton = document.getElementById('suggestionButton');
        const suggestionButtonGPT4 = document.getElementById('suggestionButtonGPT4');
        // const sucheButton = document.getElementById('sucheButton');

        let isRecording = false;
        let mediaRecorder;
        let intervalId;
        let full_transcript = '';

        suggestionButton.addEventListener('click', async () => {
            const promptText = document.getElementById('prompt').value;
            const response = await fetch('/generate-suggestionsgpt3', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ transcript: full_transcript, prompt: promptText })
            });

            const data = await response.json();
            console.log(data);
            suggestionsDiv.innerText = data.suggestions;
        });

        suggestionButtonGPT4.addEventListener('click', async () => {
            const promptText = document.getElementById('prompt').value;
            const response = await fetch('/generate-suggestionsgpt4', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ transcript: full_transcript, prompt: promptText })
            });

            const data = await response.json();
            console.log(data);
            suggestionsDiv.innerText = data.suggestions;
        });

        // sucheButton.addEventListener('click', async () => {
        //     console.log("Suche geklickt")
        //     const promptText = document.getElementById('prompt').value;
        //     const response = await fetch('/searchandgenerate', {
        //         method: 'POST',
        //         headers: {
        //             'Content-Type': 'application/json'
        //         },
        //         body: JSON.stringify({ transcript: full_transcript, prompt: promptText })
        //     });

        //     const data = await response.json();
        //     console.log(data);
        //     suggestionsDiv.innerText = data.suggestions;
        // });

        recordButton.addEventListener('click', () => {
            console.log("test")
            if (!isRecording) {
                startRecording();
                recordButton.textContent = 'Stop Recording';
            } else {
                stopRecording();
                recordButton.textContent = 'Start Recording';
            }
            isRecording = !isRecording;
        });

        async function startRecording() {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true});

            function createRecorder() {
                mediaRecorder = new MediaRecorder(stream);

                mediaRecorder.addEventListener('dataavailable', async event => {
                    console.log('Data available');
                    const audioBlob = event.data;
                    const formData = new FormData();
                    formData.append('audio', audioBlob);

                    const response = await fetch('/process-audio', {
                        method: 'POST',
                        body: formData
                    });

                    const data = await response.json();
                    if (data.transcript != null) {
                        full_transcript += data.transcript;
                        transcriptDiv.innerText = full_transcript;
                    }
                    console.log(data.transcript)
                });

                mediaRecorder.start();
            }

            createRecorder(); // Start recording initially

            // Set interval to stop current recorder and start a new one every 10 seconds
            intervalId = setInterval(() => {
                mediaRecorder.stop();
                createRecorder();
            }, 5000);
        }

        function stopRecording() {
            clearInterval(intervalId); // Stop the interval
            mediaRecorder.stop();
        }
    </script>
</body>
</html>